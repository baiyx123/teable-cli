# 货物明细指派供应商派车指南

## 概述

本指南介绍如何使用 Teable CLI 将货物明细指派给供应商派车，实现批量自动化指派操作。

## 基本流程

1. **查询需要指派的货物明细**：使用 `show` 命令查询符合条件的货物明细
2. **管道插入供应商派车记录**：将查询结果通过管道传递给 `insert` 命令，创建供应商派车记录并关联货物明细

## 命令格式

```bash
t show 货物明细表 "查询条件1" "查询条件2" ... | \
t insert 供应商派车表 \
  "货物明细表=@id" \
  "关联供应商=供应商名称" \
  "指派类型=提送货" \
  "指派时间=YYYY-MM-DD" \
  [其他字段=值]
```

## 字段说明

### 必填字段

- **货物明细表=@id**：使用管道传过来的货物明细记录ID（`@id` 表示从管道记录中获取ID）
- **关联供应商**：供应商名称，如"德邦快运股份公司"
- **指派类型**：派车类型，可选值：`提送货`、`提货`、`送货` 等
- **指派时间**：日期格式，如 `2025-11-19`

### 可选字段

- **提货费**：数字类型，提货费用
- **送货费**：数字类型，送货费用
- **运费**：数字类型，运输费用
- **其他费用**：数字类型，其他相关费用
- **派车状态**：状态值，如 `待派车`、`已派车` 等
- **备注**：文本类型，备注信息

## 实际示例

### 示例1：将南京到苏州的货物明细指派给德邦快运股份公司

```bash
# 查询从南京到苏州的货物明细
t show 货物明细表 "提货城市=南京市" "目的城市=苏州市" | \
# 插入供应商派车记录
t insert 供应商派车表 \
  "货物明细表=@id" \
  "关联供应商=德邦快运股份公司" \
  "指派类型=提送货" \
  "指派时间=2025-11-19"
```

### 示例2：将指定订单的货物明细指派给顺丰物流有限公司（包含费用）

```bash
t show 货物明细表 "委托单号 (from 关联订单)=3" | \
t insert 供应商派车表 \
  "货物明细表=@id" \
  "关联供应商=顺丰物流有限公司" \
  "指派类型=提送货" \
  "指派时间=2025-11-19" \
  "提货费=200" \
  "送货费=300" \
  "运费=1500"
```

### 示例3：将指定产品的货物明细批量指派

```bash
t show 货物明细表 "产品名称=油漆" "提货城市=上海市" | \
t insert 供应商派车表 \
  "货物明细表=@id" \
  "关联供应商=中通运输集团" \
  "指派类型=提送货" \
  "指派时间=2025-11-19"
```

## 查询条件说明

### 常用查询条件

- **按城市查询**：
  - `提货城市=上海市`
  - `目的城市=苏州市`

- **按订单查询**：
  - `委托单号 (from 关联订单)=3`

- **按产品查询**：
  - `产品名称=油漆`

- **组合查询**：
  - `提货城市=南京市` `目的城市=苏州市`
  - `产品名称=油漆` `毛重>100`

### 查询条件语法

- **精确匹配**：`字段名=值`
- **模糊匹配**：`字段名 like 值`（如果支持）
- **大于/小于**：`字段名>值`、`字段名<值`、`字段名>=值`、`字段名<=值`
- **多条件**：多个条件用空格分隔，默认是 AND 关系

## 管道操作说明

### `@id` 字段映射

在管道模式下，`@id` 表示从管道记录中获取记录ID。例如：
- `货物明细表=@id`：将管道传过来的货物明细记录ID赋值给供应商派车表的"货物明细表"字段

### 字段映射语法

- **`@字段名`**：从管道记录中获取指定字段的值
- **`常量值`**：直接使用常量值，如 `指派类型=提送货`

## 注意事项

1. **费用字段**：如果费用信息暂时不知道，可以不填写费用相关字段，后续可以再更新

2. **供应商名称**：必须使用准确的供应商名称，系统会自动查找对应的供应商记录

3. **指派类型**：需要根据实际情况选择合适的指派类型，常见的有：
   - `提送货`：既提货又送货
   - `提货`：只提货
   - `送货`：只送货

4. **日期格式**：指派时间使用 `YYYY-MM-DD` 格式，如 `2025-11-19`

5. **批量操作**：管道操作会自动处理多条记录，无需循环

6. **错误处理**：如果插入失败，会显示错误信息，成功的记录会正常插入

## 验证结果

插入完成后，可以查询验证：

```bash
# 查看指定供应商的派车记录
t show 供应商派车表 "供应商名称 (from 关联供应商)=德邦快运股份公司"

# 查看指定货物明细的派车情况
t show 供应商派车表 "货物明细表=recXXX"
```

## 常见问题

### Q: 如何知道有哪些供应商？

```bash
t show 供应商表
```

### Q: 如何查看货物明细表的字段？

```bash
t desc 货物明细表
```

### Q: 如何查看供应商派车表的字段？

```bash
t desc 供应商派车表
```

### Q: 插入失败怎么办？

检查错误信息，常见原因：
- 供应商名称不正确
- 指派类型值不正确
- 必填字段缺失
- 关联字段值无效

### Q: 如何更新已指派的记录？

使用 `update` 命令：
```bash
t update 供应商派车表 recXXX "提货费=200" "送货费=300"
```

## 完整工作流程示例

```bash
# 1. 查询需要指派的货物明细
t show 货物明细表 "提货城市=南京市" "目的城市=苏州市"

# 2. 查看可用的供应商
t show 供应商表

# 3. 批量指派（不包含费用）
t show 货物明细表 "提货城市=南京市" "目的城市=苏州市" | \
t insert 供应商派车表 \
  "货物明细表=@id" \
  "关联供应商=德邦快运股份公司" \
  "指派类型=提送货" \
  "指派时间=2025-11-19"

# 4. 验证结果
t show 供应商派车表 "供应商名称 (from 关联供应商)=德邦快运股份公司" limit=10
```

## 相关文档

- [管道操作指南](./PIPE_USAGE_GUIDE.md)
- [CLI使用手册](../README.md)

